pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
-- main

function _init()
  init_player()   
end

function _update()
  move_player()   
end

function _draw()
  cls()
  draw_map()
  draw_player()
  
  if false then
    rect(box.x,box.y,
         box.x2,box.y2,8)
  end
  
  rectfill(0,0,127,10,7)
  
end
-->8
-- movement and init

function init_player()
  pl = {}
  pl.x = 60
  pl.y = 60
  pl.ox = 60
  pl.oy = 60
  pl.w = 8
  pl.h = 8
  pl.s = 1
  
  cx = 0
  cy = 0
  
  box = {}
  box.x = 32
  box.y = 32
  box.x2 = 88
  box.y2 = 88
end

function draw_player()
  spr(pl.s, pl.x, pl.y)
end

function move_player()
  pl.s = 3
  pl.ox = pl.x
  pl.oy = pl.y
  
  if btn(1) then
    pl.x += 2  
    pl.s = 1
    if btn(5) then
      pl.x += 4
    end    
  elseif btn(0) then
    pl.x -= 2
    pl.s = 2
    if btn(5) then
      pl.x -= 4
    end
  end
  
  if btn(2) then
    pl.y -= 2
    pl.s = 4
    if btn(5) then
      pl.y -= 4
    end    
  elseif btn(3) then
    pl.y += 2
    pl.s = 3
    if btn(5) then
      pl.y += 4
    end     
  end 
  
  if map_collide(pl.x,pl.y,
                 pl.w,pl.h) then
     pl.x = pl.ox
     pl.y = pl.oy 
  end 
  
  if pl.x < box.x then
    pl.x = box.x
    if btn(5) then
      cx -= 6
    end
    cx -= 2
  elseif pl.x > box.x2 then
    pl.x = box.x2
    if btn(5) then
      cx += 6
    end
    cx += 2
  end
  
  if cx <= 0 then
    cx = 0
    box.x = 0
  elseif cx >= 128 then
    cx = 128    
    box.x2 = 127
  else 
    box.x = 32
    box.x2 = 88 
  end
  
  if pl.y < box.y then
    pl.y = box.y
    if btn(5) then
      cy -= 6
    end
    cy -= 2
  elseif pl.y > box.y2 then
    pl.y = box.y2
    if btn(5) then 
      cy += 6
    end
    cy += 2
  end
  
  if cy <= 0 then
    cy = 0
    box.y = 0
  elseif cy >= 128 then
    cy = 128
    box.y2 = 127
  else 
    box.y = 32
    box.y2 = 88
  end

end
-->8
--collision and map

function draw_map()
  camera(cx,cy)
  map(mx,my)
  camera(0,0)
  
end

function map_collide(x,y,
                     w,h)
  x += cx
  y += cy
  
  s1 = mget(x / 8, y / 8)
  s2 = mget((x+w-1) /8, y / 8)            
  s3 = mget(x / 8,(y+w-1) /8)
  s4 = mget((x+w-1) /8,(y+w-1) /8)
            
  if fget(s1,3) then                        
    return true
  elseif fget(s2,3) then
    return true
  elseif fget(s3,3) then
    return true
  elseif fget(s4,3) then
    return true
  end
  
  return false
end
__gfx__
000000003000300000030003003003000030030000000000000000005555d6550000015dd15105ddd555d515510001d100000000000000000000000000000000
000000003333600000063333036666300333333000000000000000005555d655d515d05155000d15d100055115d5515d00000000000000000000000000000000
0070070003ccc000000ccc3000c66c0000c33c000000000000000000ddddd6dd11515005100d00055d0dd0d05501551000000000000000000000000000000000
000770000c8880a00a0888c00088880000c88ca000000000000000006666666605555d010d551d0500015150d0d5515000000000000000000000000000000000
00077000cc77ccaaaacc77cc0c777aa00c8888aa00000000000000005556dddd0515100005155d0d10d5555050d155d000000000000000000000000000000000
0070070076666caaaac666670cc6aaaa0c8888aa00000000000000005556d5550d0dd0d501551055500515115000d00100000000000000000000000000000000
000000000cccc0a00a0cccc000ccaaaa00cccca00000000000000000ddd655550000001dd5155d51150d515d51d0005500000000000000000000000000000000
000000000c00c000000c00c000c00aa000c00c000000000000000000666666665150055d1d100015d51000d1dd50151d00000000000000000000000000000000
__gff__
0000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0707070707070707070707070707070707070707070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a0908080a0908080a07070a0908080a0a0908080a0908080a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b08090a080b080a080b080907070a080b08090a080b080a080b080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a0a080a090a080a090a07070a080a090a0a080a090a080a090a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a090a080a090a080907070a0908080a0a090a080a090a080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b08090b0a0a0a0b0a0a0a0b07070a080b08090b0a0a0a0b0a0a0a0b08080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a0908080a0a0908080a07070a080a090a0908080a0a0908080a08080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a090a0809080b08090a080b080908080a090a0809080b08090a080b080908080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070b0a0a0a0b080a090a0a080a090a08080b0a0a0a0b080a090a0a080a090a08080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a0908080a0908080a08080a0908080a0a0908080a0908080a08080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0908080a0a0908080a07070a0908080a0908080a0a0908080a08080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b0809080b08090a080b080907070a080b0809080b08090a080b080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a080a090a0a080a090a07070a080a090a080a090a0a080a090a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a090a0809090a08090a090a080907070a090a0809090a08090a090a080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070b0a0a0a0b0a0a0a0b0b0a0a0a0b07070b0a0a0a0b0a0a0a0b0b0a0a0a0b07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070708080707070707070707070707070707080808070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070708080707070707070707070707070707080808070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a0908080a0908080a07070a0908080a0a0908080a0908080a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b08090a080b080a080b080907070a080b08090a080b080a080b080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a0a080a090a080a090a07070a080a090a0a080a090a080a090a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a090a080a090a080907070a0908080a0a090a080a090a080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b08090b0a0a0a0b0a0a0a0b07070a080b08090b0a0a0a0b0a0a0a0b07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a0908080a0a0908080a07070a080a090a0908080a0a0908080a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a090a0809080b08090a080b080908080a090a0809080b08090a080b080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070b0a0a0a0b080a090a0a080a090a08080b0a0a0a0b080a090a0a080a090a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0a0908080a0908080a08080a0908080a0a0908080a0908080a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0908080a0908080a0a0908080a07070a0908080a0908080a0a0908080a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080b0809080b08090a080b080907070a080b0809080b08090a080b080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a080a090a080a090a0a080a090a07070a080a090a080a090a0a080a090a07000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a090a0809090a08090a090a080907070a090a0809090a08090a090a080907000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
